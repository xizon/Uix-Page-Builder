(function($){$.fn.UixPBFormPop=function(options){var settings=$.extend({'postID':'','title':'','trigger':'','errorInfo':'Timeout expired. The timeout period elapsed prior to completion of the operation or the server is not responding. ','initFunction':function(){},'startFunction':function(){}},options);this.each(function(){var $this=$(this),$ID=settings.trigger.replace('.','').replace('#',''),$title=settings.title,$postID=settings.postID,$trigger=settings.trigger,$errorInfo=settings.errorInfo,dataID='uixpbform-modal-open-'+$ID,formID=$trigger.replace('.','').replace('#','');var form={'formID':formID,'title':$title,'thisModalID':dataID,'thisFormName':$ID};if($('.uixpbform-modal-mask').length<1){$('body').prepend('<div class="uixpbform-modal-mask"></div>');}
if($('#'+form['thisModalID']).length<1){$('body').prepend('<div class="uixpbform-modal-box" id="'+form['thisModalID']+'"><a href="javascript:void(0)" class="close-btn close-uixpbform-modal">&times;</a><div class="content"><h2>'+form['title']+'</h2><span class="iconslist-box"></span><span class="echo-module-temp"></span><span class="echo-module-temp-clone" style="display:none"></span><span class="echo-frontend-temp" style="display:none"></span></div></div>');}
if(Object.prototype.toString.call(settings.initFunction)=='[object Function]'){settings.initFunction(form);}
$(document).on('click.UIXPB_FORMPOP_OPEN',$trigger,function(e){e.preventDefault();var widget_ID=$(this).data('id'),widget_name=$(this).data('name'),widget_col_ID=$(this).data('col-textareaid'),widgets={'formID':formID,'ID':widget_ID,'contentID':'content-data-'+widget_ID,'title':$title,'name':widget_name,'thisModalID':dataID,'sectionID':widget_ID,'colID':widget_col_ID},code='',$obj=$('.uixpbform-modal-box#'+dataID),modal_H_max=$(window).height()*0.8-150,echo_tmpl_ID='.uixpbform-modal-box#'+dataID+' .echo-module-temp',echo_frontend_ID='.uixpbform-modal-box#'+dataID+' .echo-frontend-temp',action_first_add=false;if($(this).parent('.uix-page-builder-col').length>0){action_first_add=true;}
if($obj.length>0){var tempID=formID,sectionID=widget_ID,colID=widget_col_ID,colIDToVar=colID.replace('---','----'),colNumber=colID.replace('col-item-','').replace('---'+sectionID,''),widgetName=widget_name,postID=$postID,renderTemp=uixpbform_module_form_ids(tempID,sectionID,colID,false);$obj.UixPBFormPopWinReset({heightChange:220});$obj.attr({'data-tempID':tempID,'data-colID':colID,'data-colIDToVar':colIDToVar,'data-sectionID':sectionID,'data-echoFrontendID':echo_frontend_ID,'data-colNumber':colNumber});$(echo_tmpl_ID).html('');if(uixpbform_isJSON(renderTemp)){$('#module_tmpl__'+tempID).tmpl(JSON.parse(renderTemp)).appendTo(echo_tmpl_ID);}
$obj.find('form [name="section"]').val(tempID);$obj.find('form [name="colid"]').val(colID);$obj.find('form [name="row"]').val(sectionID);$(document).uixpbform_init_controls({form:$obj});if(uixpbform_clonedata_exists(renderTemp)){$obj.find('.uixpbform_btn_trigger-clone').uixpbform_dynamicFormInit({type:'load'});}
if($obj.find('.iconslist-box').html().length==0){$obj.find('.iconslist-box').html($('.uixpbform-icon-selector-btn-target').html());}
var newHeight=0,hEx=0,nocols=$(echo_tmpl_ID).find('.uixpbform-form-container'),cols=$(echo_tmpl_ID).find('.uixpbform-table-cols-wrapper'),colsH=Array(),colsH_Max=0;if(cols.length>0){cols.each(function(index){var curH=$(this).height();if($(this).hasClass('uixpbform-table-col-1')){hEx=curH;}
colsH.push(parseFloat(curH)+parseFloat(hEx));});var max=-Infinity;for(var i=0;i<colsH.length;i++){if(colsH[i]>max){newHeight=colsH[i];}}}else{newHeight=nocols.height();}
if(newHeight==null||newHeight==0||parseFloat(newHeight+150+$(window).height()*0.2)>$(window).height())
{newHeight=modal_H_max;}
$obj.css('height',parseFloat(newHeight+150)+'px');$obj.find('.uixpbform-modal-buttons').css('margin-top',parseFloat(newHeight/2+20)+'px');$('.uixpbform_btn_trigger-clone').on('click',function(e){e.preventDefault();var _mh=($(window).height()*0.8-150)+150;$obj.css('height',_mh+'px');$obj.find('.uixpbform-modal-buttons').css('margin-top',_mh*0.8/2+'px');});$('.uixpbform-modal-box .close-uixpbform-modal').on('click',function(e){e.preventDefault();$(document).UixPBFormPopClose();$('.uixpbform-modal-box .iconslist-box').removeAttr('id').removeClass('active');});}
if(Object.prototype.toString.call(settings.startFunction)=='[object Function]'){settings.startFunction(widgets);}
$('.uixpbform-modal-box .close-uixpbform-modal').on('click',function(e){e.preventDefault();$(this).parent().removeClass('active');$(document).UixPBFormPopClose();$('.uixpbform-modal-box .iconslist-box').removeAttr('id').removeClass('active');});});function traverseAndUpdateData(obj){$('.uixpbform-modal-box').each(function(){var $form=obj,formID=$form.find('[name="section"]').val(),rowID=$form.find('[name="row"]').val(),colID=$form.find('[name="colid"]').val(),colIDToVar=colID.replace('---','----'),colNumber=uixpbform_to_col_numberID(colID),colContent=[],settings=[];if(typeof colID!==typeof undefined){var $jsonTextarea=$("[name^='"+formID+"-"+colIDToVar+"']"),fields=$jsonTextarea.serializeArray();colContent.push(['col',colNumber]);settings.push(['section',formID]);settings.push(['row',rowID]);settings.push(['widgetname','Section '+rowID]);for(var i=0;i<fields.length;i++){var _id=fields[i].name,_value=fields[i].value,_s_id=uixpbform_to_controlID_ToSave(_id,formID,rowID,colID);if(_id.indexOf('__index__')<0){if(_id.indexOf('_temp')<0){var callbackType=$('#'+_id).data('callback');if(typeof callbackType!==typeof undefined){_value=uixpbform_value_callback(_value,callbackType);}else{_value=uixpbform_format_text_entering(_value);}}
_value=uixpbform_textarea_to_JSONSaveData(_value);if(typeof $('#'+_id).attr('data-enter-value')!==typeof undefined){if(_value=='')_value='&nbsp;';}
colContent.push([_s_id,_value]);}}
var new_settings=JSON.stringify(colContent);uixpbform_insertCodes(formID,new_settings,colID,rowID);var gridsterInit=new UixPBGridsterMain();gridsterInit.itemSave(rowID);settings.push(['rowcontent','{allcontent}']);var layoutdata_form_data=JSON.stringify(settings);uixpbform_insertCodes(formID,layoutdata_form_data,'cols-all-content-replace-'+rowID,rowID);}});}
$(document).off('click.UIXPB_FORMPOP_SAVE').on('click.UIXPB_FORMPOP_SAVE','.uixpbform-modal-save-btn',function(e){e.preventDefault();var $form=$(this).closest('form'),$obj=$(this).closest('.uixpbform-modal-box.active'),curSaveBtn=$obj.find('.uixpbform-modal-save-btn');if(curSaveBtn.length==1){$obj.UixPBFormPopSaveAndRenderHtml({tempID:$obj.attr('data-tempID'),colID:$obj.attr('data-colID'),colIDToVar:$obj.attr('data-colIDToVar'),sectionID:$obj.attr('data-sectionID'),echoFrontendID:$obj.attr('data-echoFrontendID'),colNumber:$obj.attr('data-colNumber')});traverseAndUpdateData($form);var init_settings=$("[name='uix-page-builder-layoutdata']").val();if(init_settings.indexOf('"content":""')>=0){setTimeout(function(){traverseAndUpdateData($form);},15);}
$(document).UixPBRenderFrontendPageTrigger();}
$(document).UixPBFormPopClose();return false;});})}})(jQuery);(function($){$.fn.UixPBFormPopClose=function(options){var settings=$.extend({},options);this.each(function(){$('.uixpbform-modal-mask').fadeOut('fast');$('.uixpbform-modal-box').removeClass('active').css('height','200px');$('html').css('overflow-y','auto');})}})(jQuery);(function($){$.fn.UixPBFormPopSwitchTransition=function(options){var settings=$.extend({},options);this.each(function(){$('.uixpbform-modal-box').removeClass('active');$('html').css('overflow-y','auto');})}})(jQuery);(function($){$.fn.UixPBFormPopWinReset=function(options){var settings=$.extend({'heightChange':true},options);this.each(function(){var $this=$(this);$('.uixpbform-modal-mask').fadeIn('fast');$this.addClass('active');$this.find('.uixpbform-modal-buttons').css('margin-top','50px');if(settings.heightChange){$this.css('height',parseFloat(($(window).height()*0.8-150)+150)+'px');}
var isNumeric=/^[-+]?(\d+|\d+\.\d*|\d*\.\d+)$/;if(isNumeric.test(settings.heightChange)){$this.css('height',settings.heightChange+'px');}
$this.find('.content').animate({scrollTop:10},100);$('html').css('overflow-y','hidden');})}})(jQuery);(function($){$.fn.UixPBFormPopSaveAndRenderHtml=function(options){var settings=$.extend({'tempID':'','colID':'','colIDToVar':'','sectionID':'','echoFrontendID':'','colNumber':''},options);this.each(function(){var $this=$(this),tempID=settings.tempID,colID=settings.colID,colIDToVar=settings.colIDToVar,sectionID=settings.sectionID,echoFrontendID=settings.echoFrontendID,colNumber=settings.colNumber,renderTempID=uixpbform_module_form_ids(tempID,sectionID,colID,true),renderTempElements=[],all_field_ids=$('#uixpbform-form-all-field-ids-'+tempID).attr('data-field-ids'),all_real_field_ids_arr=[],keys=uixpbform_module_form_keys($('#module_tmpl__'+tempID).html()),cloneTempListKey=[],cloneBeforeTempListElements=[],cloneTempListElements=[],cloneTempListElements_frontend=[],cloneTempListMax=$($('#module_tmpl__'+tempID).html()).find('[data-clone-max]').attr('data-clone-max');if(typeof all_field_ids!==typeof undefined){var field_ids_arr=all_field_ids.split(',');for(var i=0;i<field_ids_arr.length;i++){var rid=uixpbform_to_controlName_ToVar(field_ids_arr[i],tempID,sectionID,colID);if(rid!=''){var _old_field_name=uixpbform_to_controlVarID_ToName(rid),_new_field_name=uixpbform_filter_control_id(_old_field_name);rid=rid.replace(_old_field_name,_new_field_name);all_real_field_ids_arr.push(rid);}}}
$("[name^='"+tempID+"-"+colIDToVar+"']").each(function(){var _id=$(this).attr('id').replace(tempID+'-'+colIDToVar+'-','').replace('-'+sectionID+'-','');if(_id.indexOf('__index__')<0&&_id.indexOf('_temp')>=0){all_real_field_ids_arr.push($(this).attr('id'));}});if(typeof cloneTempListMax!==typeof undefined&&cloneTempListMax>0){var cloneIDs=[];for(var k=1;k<cloneTempListMax;k++){for(var i=0;i<all_real_field_ids_arr.length;i++){if(all_real_field_ids_arr[i].indexOf('_listitem')>=0){if($('#'+all_real_field_ids_arr[i]+k).length>0){cloneIDs.push(all_real_field_ids_arr[i]+k);}}}}
all_real_field_ids_arr=all_real_field_ids_arr.concat(cloneIDs);}
for(var i=0;i<all_real_field_ids_arr.length;i++){var $field=$('#'+all_real_field_ids_arr[i]);var curdata=uixpbform_format_textarea($field);if(curdata!=''){$field.val(curdata);}
var _id=all_real_field_ids_arr[i].replace(tempID+'-'+colIDToVar+'-','').replace('-'+sectionID+'-',''),_value=uixpbform_to_controlSaveData_ToHTML(uixpbform_filter_control_val($field.val()));if(_id.indexOf('__index__')<0){if(_id.indexOf('_triggerclonelist')>=0&&_id.indexOf('_temp')<0){_id=_id+'__fieldID';}else if(_id.indexOf('_listitem')>=0&&_id.indexOf('_temp')<0){_id=_id+'__fieldVal';}
if(_id.indexOf('_temp')<0){var callbackType=$field.data('callback');if(typeof callbackType!==typeof undefined){_value=uixpbform_value_callback(_value,callbackType);}else{_value=uixpbform_format_text_entering(_value);}}
renderTempElements.push({[_id]:_value});}}
if(typeof cloneTempListMax!==typeof undefined&&cloneTempListMax>0&&Object.prototype.toString.call(renderTempElements)==='[object Array]'){for(var i=0;i<renderTempElements.length;i++){var _field_value=renderTempElements[i],_field_str=JSON.stringify(_field_value);if(_field_str.indexOf('_listitem')>=0&&_field_str.indexOf('_temp')<0){var _loop_key_id_arr=_field_str.replace(/^\{?|\}?$/g,'').split(':'),_loop_old_key_id=_loop_key_id_arr[0].replace(/"/g,''),_loop_new_key_id=uixpbform_filter_control_id(uixpbform_to_cloneControlKey_ToSave(_loop_old_key_id));_field_str=_field_str.replace(_loop_old_key_id,_loop_new_key_id);cloneTempListElements.push(uixpbform_to_cloneControlKey_ToSave(_field_str));if(uixpbform_to_cloneControlKey_notLoopIndex(_loop_old_key_id)){cloneBeforeTempListElements.push(uixpbform_to_cloneControlKey_ToSave(_field_str));}}}
for(var i=0;i<cloneTempListElements.length;i++){cloneTempListElements_frontend.push(JSON.parse(cloneTempListElements[i]));}
if(Object.prototype.toString.call(keys)==='[object Array]'){for(var i=0;i<keys.length;i++){if(keys[i].indexOf('_triggerclonelist')>=0){cloneTempListKey.push(keys[i]);}}}
var cloneBeforeTempListTotal=0,cloneTempListTotal=0,cloneTempListJsonArr=[],cloneTempListJson='';var cloneBeforeTempListTotal_one_col=0,cloneBeforeTempListTotal_two_col=0,cloneBeforeTempListTotal_three_col=0,cloneBeforeTempListTotal_four_col=0,cloneTempListTotal_one_col=0,cloneTempListTotal_two_col=0,cloneTempListTotal_three_col=0,cloneTempListTotal_four_col=0,cloneTempListJson_one='',cloneTempListJson_two='',cloneTempListJson_three='',cloneTempListJson_four='',cloneTempListJsonArr_one=[],cloneTempListJsonArr_two=[],cloneTempListJsonArr_three=[],cloneTempListJsonArr_four=[];for(var k=0;k<cloneBeforeTempListElements.length;k++){var _v=cloneBeforeTempListElements[k];if(_v.indexOf('_one_')>=0)cloneBeforeTempListTotal_one_col++;if(_v.indexOf('_two_')>=0)cloneBeforeTempListTotal_two_col++;if(_v.indexOf('_three_')>=0)cloneBeforeTempListTotal_three_col++;if(_v.indexOf('_four_')>=0)cloneBeforeTempListTotal_four_col++;if(_v.indexOf('_one_')<0&&_v.indexOf('_two_')<0&&_v.indexOf('_three_')<0&&_v.indexOf('_four_')<0){cloneBeforeTempListTotal++;}}
for(var k=0;k<cloneTempListElements_frontend.length;k++){var _el=cloneTempListElements_frontend[k],_v=JSON.stringify(_el);if(_v.indexOf('_one_')>=0)cloneTempListTotal_one_col++,cloneTempListJsonArr_one.push(_el);if(_v.indexOf('_two_')>=0)cloneTempListTotal_two_col++,cloneTempListJsonArr_two.push(_el);if(_v.indexOf('_three_')>=0)cloneTempListTotal_three_col++,cloneTempListJsonArr_three.push(_el);if(_v.indexOf('_four_')>=0)cloneTempListTotal_four_col++,cloneTempListJsonArr_four.push(_el);if(_v.indexOf('_one_')<0&&_v.indexOf('_two_')<0&&_v.indexOf('_three_')<0&&_v.indexOf('_four_')<0){cloneTempListTotal++;cloneTempListJsonArr.push(_el);}}
cloneTempListJson=uixpbform_cloned_groupStr_frontend(cloneTempListJsonArr,cloneTempListTotal,cloneBeforeTempListTotal);cloneTempListJson_one=uixpbform_cloned_groupStr_frontend(cloneTempListJsonArr_one,cloneTempListTotal_one_col,cloneBeforeTempListTotal_one_col);cloneTempListJson_two=uixpbform_cloned_groupStr_frontend(cloneTempListJsonArr_two,cloneTempListTotal_two_col,cloneBeforeTempListTotal_two_col);cloneTempListJson_three=uixpbform_cloned_groupStr_frontend(cloneTempListJsonArr_three,cloneTempListTotal_three_col,cloneBeforeTempListTotal_three_col);cloneTempListJson_four=uixpbform_cloned_groupStr_frontend(cloneTempListJsonArr_four,cloneTempListTotal_four_col,cloneBeforeTempListTotal_four_col);if(cloneTempListKey.length>0){for(var p=0;p<cloneTempListKey.length;p++){var _key=cloneTempListKey[p];if(_key.indexOf('_one_')>=0&&cloneTempListJson_one.length>0)renderTempElements.push({[_key]:cloneTempListJson_one});if(_key.indexOf('_two_')>=0&&cloneTempListJson_two.length>0)renderTempElements.push({[_key]:cloneTempListJson_two});if(_key.indexOf('_three_')>=0&&cloneTempListJson_three.length>0)renderTempElements.push({[_key]:cloneTempListJson_three});if(_key.indexOf('_four_')>=0&&cloneTempListJson_four.length>0)renderTempElements.push({[_key]:cloneTempListJson_four});if(_key.indexOf('_one_')<0&&_key.indexOf('_two_')<0&&_key.indexOf('_three_')<0&&_key.indexOf('_four_')<0&&cloneTempListJson.length>0){renderTempElements.push({[_key]:cloneTempListJson});}}}}
renderTempElements=uixpbform_arr_to_tempjson(renderTempElements,false,true);renderTempElements=uixpbform_module_form_JsonResult_frontend(renderTempElements);$(echoFrontendID).html('');$('#frontend_module_tmpl__'+tempID).tmpl(JSON.parse(renderTempElements)).appendTo(echoFrontendID);var htmlcode=$(echoFrontendID).html();$('#'+renderTempID).val(htmlcode);$(document).UixPBRenderHTML({divID:'#section_'+sectionID+'__'+colNumber,value:uixpbform_format_text_decode(htmlcode,true)});})}})(jQuery);